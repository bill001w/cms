<!DOCTYPE html>
<!-- saved from url=(0066)http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html -->
<html><style type="text/css" id="89063105676"></style><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<title>CodeIgniter源码分析之Router.php – Calix的博客</title>
<script>
window._deel = {name: 'Calix',url: 'http://calixwu.com/wp-content/themes/yusi1.0', ajaxpager: '', commenton: 1, roll: [0,0]}
</script>
<meta name="author" content="calix,吴国清,calixwu">
<link rel="stylesheet" id="style-css" href="./CodeIgniter源码分析之Router.php – Calix的博客_files/style.css" type="text/css" media="all">
<script type="text/javascript" src="./CodeIgniter源码分析之Router.php – Calix的博客_files/jquery.min.js"></script>
<script type="text/javascript" src="./CodeIgniter源码分析之Router.php – Calix的博客_files/jquery.js"></script>
<link rel="prev" title="CodeIgniter源码分析之Exception.php" href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-exception-php.html">
<link rel="next" title="CodeIgniter源码分析之URI.php" href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html">
<link rel="canonical" href="./CodeIgniter源码分析之Router.php – Calix的博客_files/CodeIgniter源码分析之Router.php – Calix的博客.html">
<link rel="shortlink" href="http://calixwu.com/?p=29">
<meta name="keywords" content="CodeIgniter, MVC, ROUTER, URI, 框架, 源码分析, CodeIgniter">
<meta name="description" content="作者：Calix &lt;?php if ( ! defined(&#39;BASEPATH&#39;)) exit(&#39;No direct script access allowed&#39;);  // ------------------------------------------------------------------------  /** * Router Class */ class CI_Router {  /** * Config c">
<style type="text/css" id="syntaxhighlighteranchor"></style>
<!--[if lt IE 9]><script src="http://calixwu.com/wp-content/themes/yusi1.0/js/html5.js"></script><![endif]-->
<script src="./CodeIgniter源码分析之Router.php – Calix的博客_files/share.js"></script><link href="./CodeIgniter源码分析之Router.php – Calix的博客_files/share.css" rel="styleSheet" type="text/css"></head>
<body class="single single-post postid-29 single-format-standard">

<header id="header" class="header">
<div class="container-inner">
 <div class="yusi-logo">
                    <a href="http://calixwu.com/">
                        <h1>
                                                        <span class="yusi-mono">Calix</span>
                                                        <span class="yusi-bloger">善于总结。</span>
                                                    </h1>
                    </a>
    </div>
</div>

	<div id="nav-header" class="navbar">
		
		<ul class="nav">
			<li id="menu-item-4" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-4"><a href="http://calixwu.com/">首页</a></li>
<li style="float:right;">
                    <div class="toggle-search"><i class="fa fa-search"></i></div>
<div class="search-expand" style="display: none;"><div class="search-expand-inner"><form method="get" class="searchform themeform" onsubmit="location.href=&#39;http://calixwu.com/search/&#39; + encodeURIComponent(this.s.value).replace(/%20/g, &#39;+&#39;); return false;" action="http://calixwu.com/"><div> <input type="ext" class="search" name="s" onblur="if(this.value==&#39;&#39;)this.value=&#39;search...&#39;;" onfocus="if(this.value==&#39;search...&#39;)this.value=&#39;&#39;;" value="search..."></div></form></div></div>
</li>
		</ul><div class="screen-mini"><button data-type="screen-nav" class="btn btn-inverse screen-nav"><i class="fa fa-list"></i></button></div>
	</div>
</header>
<section class="container"><div class="speedbar">
				<div class="toptip"><strong class="text-success"><i class="fa fa-volume-up"></i> </strong> </div>
	</div>
	<div class="content-wrap">
	<div class="content">

				<header class="article-header">
			<h1 class="article-title"><a href="./CodeIgniter源码分析之Router.php – Calix的博客_files/CodeIgniter源码分析之Router.php – Calix的博客.html">CodeIgniter源码分析之Router.php</a></h1>
			<div class="meta">
				<span id="mute-category" class="muted"><i class="fa fa-list-alt"></i><a href="http://calixwu.com/category/codeigniter"> CodeIgniter</a></span>				<!--
				<span class="muted"><i class="fa fa-user"></i> <a href="http://calixwu.com/author/calix">calix</a></span>-->
				<time class="muted"><i class="fa fa-clock-o"></i> 2年前 (2014-11-19)</time>
				<span class="muted" style="color:#dd6666"><i class="fa fa-eye"></i> 1375℃</span>
											</div>
		</header>
		<article class="article-content">
			<p>作者：<a href="http://calixwu.com/" data-original-title="" title="">Calix</a></p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="pun">&lt;?</span><span class="pln">php </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> </span><span class="kwd">defined</span><span class="pun">(</span><span class="str">'BASEPATH'</span><span class="pun">))</span><span class="pln"> </span><span class="kwd">exit</span><span class="pun">(</span><span class="str">'No direct script access allowed'</span><span class="pun">);</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">// ------------------------------------------------------------------------</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">/**</span></li><li class="L5"><span class="com">* Router Class</span></li><li class="L6"><span class="com">*/</span></li><li class="L7"><span class="kwd">class</span><span class="pln"> CI_Router </span><span class="pun">{</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">/**</span></li><li class="L0"><span class="com">* Config class</span></li><li class="L1"><span class="com">*/</span></li><li class="L2"><span class="kwd">var</span><span class="pln"> $config</span><span class="pun">;</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">/**</span></li><li class="L5"><span class="com">* List of routes</span></li><li class="L6"><span class="com">&nbsp;</span></li><li class="L7"><span class="com">*/</span></li><li class="L8"><span class="kwd">var</span><span class="pln"> $routes </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* List of error routes</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="kwd">var</span><span class="pln"> $error_routes </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">/**</span></li><li class="L6"><span class="com">* Current class name</span></li><li class="L7"><span class="com">*/</span></li><li class="L8"><span class="kwd">var</span><span class="pln"> $class </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* Current method name</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="kwd">var</span><span class="pln"> $method </span><span class="pun">=</span><span class="pln"> </span><span class="str">'index'</span><span class="pun">;</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">/**</span></li><li class="L6"><span class="com">* Sub-directory that contains the requested controller class</span></li><li class="L7"><span class="com">*/</span></li><li class="L8"><span class="kwd">var</span><span class="pln"> $directory </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* Default controller (and method if specific)</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="kwd">var</span><span class="pln"> $default_controller</span><span class="pun">;</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">/**</span></li><li class="L6"><span class="com">* Constructor</span></li><li class="L7"><span class="com">*/</span></li><li class="L8"><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">()</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config </span><span class="pun">=&amp;</span><span class="pln"> load_class</span><span class="pun">(</span><span class="str">'Config'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'core'</span><span class="pun">);</span></li><li class="L1"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri </span><span class="pun">=&amp;</span><span class="pln"> load_class</span><span class="pun">(</span><span class="str">'URI'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'core'</span><span class="pun">);</span></li><li class="L2"><span class="pln">log_message</span><span class="pun">(</span><span class="str">'debug'</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Router Class Initialized"</span><span class="pun">);</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">// --------------------------------------------------------------------</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">/**</span></li><li class="L8"><span class="com">* Set the route mapping</span></li><li class="L9"><span class="com">*/</span></li><li class="L0"><span class="kwd">function</span><span class="pln"> _set_routing</span><span class="pun">()</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">//如果项目是允许通过query_strings的形式，并且有通过$_GET的方式请求控制器的话，则以query_string形式，也就是</span></li><li class="L4"><span class="com">//?c=xx的形式确定路由。</span></li><li class="L5"><span class="pln">$segments </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L6"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'enable_query_strings'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> TRUE AND isset</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">[</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'controller_trigger'</span><span class="pun">)]))</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="com">//上面这里为什么还要判断有没有通过get的方式指定控制器？其实是因为如果允许query_string的形式请求路由，但是却</span></li><li class="L9"><span class="com">//没有通过query_string（或者说是get）的形式指定路由的话（其实就说明这个通过query_string方式的uri是无效的），</span></li><li class="L0"><span class="com">//此时,我们依然会采用“段”的形式。</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">//取得目录名,目录名，控制名和方法名传递的变量名都是可以自定义的，在config/config.php里面。</span></li><li class="L3"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">[</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'directory_trigger'</span><span class="pun">)]))</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_directory</span><span class="pun">(</span><span class="pln">trim</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_filter_uri</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">[</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'directory_trigger'</span><span class="pun">)])));</span></li><li class="L6"><span class="pln">$segments</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">fetch_directory</span><span class="pun">();</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">//取得控制器名</span></li><li class="L0"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">[</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'controller_trigger'</span><span class="pun">)]))</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">trim</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_filter_uri</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">[</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'controller_trigger'</span><span class="pun">)])));</span></li><li class="L3"><span class="pln">$segments</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">fetch_class</span><span class="pun">();</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">//取得方法名</span></li><li class="L7"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">[</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'function_trigger'</span><span class="pun">)]))</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="pln">trim</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_filter_uri</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">[</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'function_trigger'</span><span class="pun">)])));</span></li><li class="L0"><span class="pln">$segments</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">fetch_method</span><span class="pun">();</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="com">//。。。。。。。。。。。。。。。位置1</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">// Load the routes.php file.</span></li><li class="L6"><span class="com">//引入关于路由方面的配置信息。配置文件里面是一个名字为$route的数组。</span></li><li class="L7"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">defined</span><span class="pun">(</span><span class="str">'ENVIRONMENT'</span><span class="pun">)</span><span class="pln"> AND is_file</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'config/'</span><span class="pun">.</span><span class="pln">ENVIRONMENT</span><span class="pun">.</span><span class="str">'/routes.php'</span><span class="pun">))</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">include</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'config/'</span><span class="pun">.</span><span class="pln">ENVIRONMENT</span><span class="pun">.</span><span class="str">'/routes.php'</span><span class="pun">);</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">elseif </span><span class="pun">(</span><span class="pln">is_file</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'config/routes.php'</span><span class="pun">))</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">include</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'config/routes.php'</span><span class="pun">);</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">//下面这个莫名出现的$route变量(注意不是$this-&gt;routes哦)，就是写在配置文件里面。把它copy到$this-&gt;routes。</span></li><li class="L7"><span class="com">//这个$routes是用来指定默认控制器和默认方法，404（请求路由不存在）后规定的路由以及一些路由重定向（？这个重写向的</span></li><li class="L8"><span class="com">//实现在Router::_parse_routes()中实现）的信息。</span></li><li class="L9"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">routes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> isset</span><span class="pun">(</span><span class="pln">$route</span><span class="pun">)</span><span class="pln"> OR </span><span class="pun">!</span><span class="pln"> is_array</span><span class="pun">(</span><span class="pln">$route</span><span class="pun">))</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> array</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> $route</span><span class="pun">;</span></li><li class="L0"><span class="pln">unset</span><span class="pun">(</span><span class="pln">$route</span><span class="pun">);</span><span class="com">//利用完就干掉。</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">//根据刚才的配置信息，设定默认控制器，没有的话，就为FLASE。</span></li><li class="L3"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> isset</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="str">'default_controller'</span><span class="pun">])</span><span class="pln"> OR $this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="str">'default_controller'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> FALSE </span><span class="pun">:</span><span class="pln"> strtolower</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="str">'default_controller'</span><span class="pun">]);</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">//这个判断的位置放得有点怪，我觉得可以放到上面“位置1”的地方，下面的代码是判断刚才有没有通过query_string的方式拿到</span></li><li class="L6"><span class="com">//路由信息，如果拿到的话，那么就不再尝试“段”的方式确定路由了。直接确定路由，结束本函数。</span></li><li class="L7"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">count</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="com">//_validate_quest($segments);的作用就是确定并设置路由。</span></li><li class="L0"><span class="com">//这个函数执行完之后，Router::$class,Router::$directory（如果有）都会有相应值。</span></li><li class="L1"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_validate_request</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">);</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">//下面的_fetch_uri_string()详见：URI.php，在这个位置只需知道它的作用是：</span></li><li class="L5"><span class="com">//从uri中检测处理，把我们确定路由需要的信息（例如“index.php/index/welcome/1”后</span></li><li class="L6"><span class="com">//面"index/welcome/1"这串）放到$this-&gt;uri-&gt;uri_string这个东西中。</span></li><li class="L7"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_fetch_uri_string</span><span class="pun">();</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">//上面_fetch_uri_string()完了之后，这个uri_string就会有我们要用的信息，如果为空的话，那么就用把路由设置为默认的。</span></li><li class="L0"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">uri_string </span><span class="pun">==</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="com">//移步至Router::_set_default_controller();</span></li><li class="L3"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_set_default_controller</span><span class="pun">();</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">//如果$this-&gt;uri-&gt;uri_string 不为空，那么，会通过下面的方式确定路由</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">//这里只是简单地把后缀去掉而已，因为CI允许在uri后面加后缀，但它其实对我们寻找路由是多余，而且会造成影响的，所以先去掉。</span></li><li class="L9"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_remove_url_suffix</span><span class="pun">();</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">//把最初的uri，变成数组放在segments里面。</span></li><li class="L2"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_explode_segments</span><span class="pun">();</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">//开始找路由。移步至 Router::_parse_routes();</span></li><li class="L5"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_parse_routes</span><span class="pun">();</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">//设置为由1开始。</span></li><li class="L8"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_reindex_segments</span><span class="pun">();</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">// --------------------------------------------------------------------</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* Set the default controller</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">function</span><span class="pln"> _set_default_controller</span><span class="pun">()</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="com">//在Router::_set_routing()函数里面有一个操作，是从配置文件里面读取默认控制器名，如果没有就有FALSE。</span></li><li class="L9"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller </span><span class="pun">===</span><span class="pln"> FALSE</span><span class="pun">)</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="com">//如果没有默认的话，就报错，结束程序。</span></li><li class="L2"><span class="com">//实质上，这个_set_default_controller()仅仅是在uri没有指定控制器，要求访问默认控制器的时候才</span></li><li class="L3"><span class="com">//被调用，所以如果连默认控制器都没有，那么可以果断报错。</span></li><li class="L4"><span class="pln">show_error</span><span class="pun">(</span><span class="str">"Unable to determine what should be displayed. A default route has not been specified in the routing file."</span><span class="pun">);</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">//如果有，下面我们就来把默认的控制器设置为当前要找的路由。</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">//这里只是分“有指定默认方法”和“没有指定”两种情况而已。不过要弄点下面那个$this-&gt;_set_request($x);CI这几个函数</span></li><li class="L0"><span class="com">//也许写得很妙，但是让人看得纠结。。。</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">strpos</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> FALSE</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">$x </span><span class="pun">=</span><span class="pln"> explode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">);</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]);</span></li><li class="L7"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_request</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">);</span><span class="com">//移步至Router::_set_request();</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="kwd">else</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">);</span></li><li class="L2"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">);</span></li><li class="L3"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_request</span><span class="pun">(</span><span class="pln">array</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">,</span><span class="pln"> </span><span class="str">'index'</span><span class="pun">));</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">// re-index the routed segments array so it starts with 1 rather than 0</span></li><li class="L7"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">_reindex_segments</span><span class="pun">();</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="pln">log_message</span><span class="pun">(</span><span class="str">'debug'</span><span class="pun">,</span><span class="pln"> </span><span class="str">"No URI present. Default controller set."</span><span class="pun">);</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">// --------------------------------------------------------------------</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">/**</span></li><li class="L5"><span class="com">* Set the Route</span></li><li class="L6"><span class="com">*/</span></li><li class="L7"><span class="kwd">function</span><span class="pln"> _set_request</span><span class="pun">(</span><span class="pln">$segments </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">())</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="com">/**</span></li><li class="L0"><span class="com">* 下面来解剖一下这个让人纠结的函数。。第一次看的时候差点被它们这几个函数搞晕。</span></li><li class="L1"><span class="com">*/</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* 看，这里有调用Router::_validate_request();而Router::_validate_request()的作用是检测寻找出一个</span></li><li class="L5"><span class="com">* 正确存在的路由，并确定它，确定后的值分别放到Rouer::$class这些属性里面。所以使到这个_set_request()也有</span></li><li class="L6"><span class="com">* 这种确定路由的功能。</span></li><li class="L7"><span class="com">*</span></li><li class="L8"><span class="com">* 注：</span></li><li class="L9"><span class="com">* $segments=$this-&gt;_validate_request($segments); 等式右边，括号里面的这个$segments，也就是调用</span></li><li class="L0"><span class="com">* _set_request()时传入来的这个参数，它有这样的特点：</span></li><li class="L1"><span class="com">* 1）如果这时_set_request()是在Router::_set_default_controller()中调用的话，那个这个$segments是永远不会为</span></li><li class="L2"><span class="com">* 空数组，嗯，绝对不会。</span></li><li class="L3"><span class="com">*</span></li><li class="L4"><span class="com">*</span></li><li class="L5"><span class="com">* 而左边这个$segments的值，经过下面这行代码后，要么为空数组array(),要么为确定路由后的段数组。</span></li><li class="L6"><span class="com">* 为空数组的原因是，$this-&gt;_validate_request();里面没有找到当前目录的默认控制器。此时，右边的</span></li><li class="L7"><span class="com">* $segments要么为空，要么只指定了目录但默认控制器不存在。</span></li><li class="L8"><span class="com">*/</span></li><li class="L9"><span class="pln">$segments </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_validate_request</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">);</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">count</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="com">//所以如果上面返回了空数组，就会进到这里。</span></li><li class="L4"><span class="com">//这里居然又调回了_set_default_controller()! 坑爹吧！</span></li><li class="L5"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_set_default_controller</span><span class="pun">();</span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* 我曾经想过，下面这里会不会死循环：</span></li><li class="L8"><span class="com">* 假如，我在配置文件里面的默认控制器设为welcome，然后controllers/下没有welcome.php,但controllers/下有</span></li><li class="L9"><span class="com">* welcome/有这个目录（里面没东西），然后通过http://localhost/CI/来访问默认控制器，那会怎样呢？</span></li><li class="L0"><span class="com">* 首先，它会进入_set_routing();然后发现$this-&gt;uri-&gt;uri_string为空，进入_set_default_controller();</span></li><li class="L1"><span class="com">* 然后发现在_set_default_controller里，发现$this-&gt;default_controller不为FALSE，（＠＠＠＠），然后再</span></li><li class="L2"><span class="com">* 进入这_set_request()里面，再进入_validate_request()里面，会不会_validate_request里返回空数组？因为</span></li><li class="L3"><span class="com">* 指定了目录，没有指定控制器，访问默认的，又不存在，然后返回空数组，返回空数组后，最终就会走来你正在看的这个位置，</span></li><li class="L4"><span class="com">* 然后这个位置再调用_set_default_controller();然后死循环了。。。</span></li><li class="L5"><span class="com">*</span></li><li class="L6"><span class="com">* 答案是不会的。</span></li><li class="L7"><span class="com">* 原因在于：</span></li><li class="L8"><span class="com">* 我们回到上面解译那个（＠＠＠＠）的地方，在这里，发现$this-&gt;default_controller不为FALSE后，它会进入这个else</span></li><li class="L9"><span class="com">* 里面</span></li><li class="L0"><span class="com">* else</span></li><li class="L1"><span class="com">* {</span></li><li class="L2"><span class="com">* $this-&gt;set_class($this-&gt;default_controller); ..............1</span></li><li class="L3"><span class="com">* $this-&gt;set_method('index'); ...................2</span></li><li class="L4"><span class="com">* $this-&gt;_set_request(array($this-&gt;default_controller, 'index')); ..........3</span></li><li class="L5"><span class="com">* }</span></li><li class="L6"><span class="com">*</span></li><li class="L7"><span class="com">* 然后第3行，传入_set_request($segments)中的那个$segments其实是</span></li><li class="L8"><span class="com">* array('welcome','index')，重点在于那个小小的'index'!!!!!!!</span></li><li class="L9"><span class="com">* 这样一来，我们进入_validate_request()的时候，我们实质并没有“指定目录但没有指定控制器，访问默认控制器”，</span></li><li class="L0"><span class="com">* 而是“指定了一个welcome的目录，和一个叫index的控制器！！”，所以才不会死循环。</span></li><li class="L1"><span class="com">* 如果你试着把第3行那个'index'去掉，那么，一定会死循环！！！！！！！！不信试试！CI太牛逼了，居然这样做。汗。。</span></li><li class="L2"><span class="com">* 当然，‘index’还有一个作用，就是设置默认方法啦。</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]))</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="com">// A standard method request</span></li><li class="L1"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]);</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="kwd">else</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">$segments</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'index'</span><span class="pun">;</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">//这里要说一下，现在是在ROUTER里面为URI赋值，URI里面的这个URI::$rsegments是经过处理，并确定路由后，实质调用的路由的段信息。</span></li><li class="L9"><span class="com">//而URI::$segments （前面少了个r），则是原来没处理前的那个，即直接由网址上面得出来的那个。</span></li><li class="L0"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">rsegments </span><span class="pun">=</span><span class="pln"> $segments</span><span class="pun">;</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">// --------------------------------------------------------------------</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">/**</span></li><li class="L6"><span class="com">* Validates the supplied segments. Attempts to determine the path to</span></li><li class="L7"><span class="com">* the controller.</span></li><li class="L8"><span class="com">*/</span></li><li class="L9"><span class="kwd">function</span><span class="pln"> _validate_request</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">)</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">count</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="kwd">return</span><span class="pln"> $segments</span><span class="pun">;</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">file_exists</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'controllers/'</span><span class="pun">.</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="str">'.php'</span><span class="pun">))</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="com">//如果直接在controllers这个目录下找到与第一段相应的控制器名，那就说明找到了控制器，确定路由，返回。</span></li><li class="L9"><span class="kwd">return</span><span class="pln"> $segments</span><span class="pun">;</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">//如果上面没有找到，再看看这个“第一段”是不是一个目录，因为CI是允许控制器放在自定义的目录下的。</span></li><li class="L3"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">is_dir</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'controllers/'</span><span class="pun">.</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]))</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="com">// Set the directory and remove it from the segment array</span></li><li class="L6"><span class="com">//如果的确是目录，那么就可以确定路由的目录部分了。</span></li><li class="L7"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_directory</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L8"><span class="com">//去掉目录部分。进一步进行路由寻找。</span></li><li class="L9"><span class="pln">$segments </span><span class="pun">=</span><span class="pln"> array_slice</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">//如果uri请求中除了目录还有其它“段”，那说明是有请求某指定控制器的。</span></li><li class="L2"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">count</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="com">//指定请求的控制器找不到的话，那只好报错了。</span></li><li class="L5"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> file_exists</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'controllers/'</span><span class="pun">.</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">fetch_directory</span><span class="pun">().</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="str">'.php'</span><span class="pun">))</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="com">//报错也有两方式，一种是默认的，一种是自义定的。</span></li><li class="L8"><span class="com">//下面这个404_override就是在config/routes.php定义的一个路由找不到时候的默认处理控制器了，如果有定义</span></li><li class="L9"><span class="com">//我们调用它。</span></li><li class="L0"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> empty</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="str">'404_override'</span><span class="pun">]))</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">$x </span><span class="pun">=</span><span class="pln"> explode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="str">'404_override'</span><span class="pun">]);</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_directory</span><span class="pun">(</span><span class="str">''</span><span class="pun">);</span><span class="com">//把刚才设置好的路由的目录部分去掉，因为现在路由是我们定义的404路由。</span></li><li class="L5"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span><span class="com">//这里可以看出，我们定义的404路由是不允许放在某个目录下的，只能直接放在controllers/下</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $x</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'index'</span><span class="pun">);</span><span class="com">//默认是index方法</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="kwd">return</span><span class="pln"> $x</span><span class="pun">;</span><span class="pln"> </span><span class="com">//同样，返回“段”数组</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="kwd">else</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="com">//默认找不到路由的方法。在core/Common.php中定义的全局函数（实质调用Exception组件进行处理）。</span></li><li class="L3"><span class="pln">show_404</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">fetch_directory</span><span class="pun">().</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="kwd">else</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="com">//来到这里，说明了是uri请求指定了目录，而没有指定控制器的情况下。那么，我们默认当前路由是在当前目录下请求默认的</span></li><li class="L0"><span class="com">//控制器和方法。</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">//下面这个判断只是判断一下$this-&gt;default_controller有没有指定方法而已。</span></li><li class="L3"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">strpos</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> FALSE</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">$x </span><span class="pun">=</span><span class="pln"> explode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">);</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L7"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]);</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="kwd">else</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">);</span></li><li class="L2"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="str">'index'</span><span class="pun">);</span><span class="com">//没有的话就默认为index方法。</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">// Does the default controller exist in the sub-folder?</span></li><li class="L6"><span class="com">//如果连默认控制器都不存在的话，就无语了，说明uri打算请求这个目录的默认控制器，结果没有这个默认控制器，那暂时</span></li><li class="L7"><span class="com">//返回个空数组。（但是看清楚，上面已经$this-&gt;set_class()了，说明即使没有，我们也已经把默认控制器的名字算</span></li><li class="L8"><span class="com">//是确定下来先）</span></li><li class="L9"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> file_exists</span><span class="pun">(</span><span class="pln">APPPATH</span><span class="pun">.</span><span class="str">'controllers/'</span><span class="pun">.</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">fetch_directory</span><span class="pun">().</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">default_controller</span><span class="pun">.</span><span class="str">'.php'</span><span class="pun">))</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">directory </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L2"><span class="kwd">return</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">//能够有命来到这一步，是说明的确是某个目录下找到了控制器，或者是找到了定义的默认控制器。</span></li><li class="L8"><span class="com">//但是注意，这个$segments返回的“段”信息都是不包括目录的。它是一个数组形式，第一个元素是控制器名。</span></li><li class="L9"><span class="com">//例如：array('acontroller','amethod','xx','xx')。。</span></li><li class="L0"><span class="kwd">return</span><span class="pln"> $segments</span><span class="pun">;</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">//来到这里，就说明了，即找不到controllers/下相应的控制器，也找不到这样的目录。那就报错咯。</span></li><li class="L4"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> empty</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="str">'404_override'</span><span class="pun">]))</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="pln">$x </span><span class="pun">=</span><span class="pln"> explode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="str">'404_override'</span><span class="pun">]);</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L9"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$x</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $x</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'index'</span><span class="pun">);</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="kwd">return</span><span class="pln"> $x</span><span class="pun">;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">// Nothing else to do at this point but show a 404</span></li><li class="L5"><span class="pln">show_404</span><span class="pun">(</span><span class="pln">$segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">// --------------------------------------------------------------------</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* Parse Routes</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="kwd">function</span><span class="pln"> _parse_routes</span><span class="pun">()</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="com">// Turn the segment array into a URI string</span></li><li class="L6"><span class="com">//知道_set_request()是干嘛的之后，下面的条理就比较清晰了。</span></li><li class="L7"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> implode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">);</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// Is there a literal match? If so we're done</span></li><li class="L0"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="pln">$uri</span><span class="pun">]))</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_set_request</span><span class="pun">(</span><span class="pln">explode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">routes</span><span class="pun">[</span><span class="pln">$uri</span><span class="pun">]));</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">/**</span></li><li class="L6"><span class="com">* CI有路由重定向的功能，重定向的规则和实现就是在这里。</span></li><li class="L7"><span class="com">*/</span></li><li class="L8"><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">routes </span><span class="kwd">as</span><span class="pln"> $key </span><span class="pun">=&gt;</span><span class="pln"> $val</span><span class="pun">)</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$key </span><span class="pun">=</span><span class="pln"> str_replace</span><span class="pun">(</span><span class="str">':any'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'.+'</span><span class="pun">,</span><span class="pln"> str_replace</span><span class="pun">(</span><span class="str">':num'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'[0-9]+'</span><span class="pun">,</span><span class="pln"> $key</span><span class="pun">));</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">preg_match</span><span class="pun">(</span><span class="str">'#^'</span><span class="pun">.</span><span class="pln">$key</span><span class="pun">.</span><span class="str">'$#'</span><span class="pun">,</span><span class="pln"> $uri</span><span class="pun">))</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="com">// Do we have a back-reference?</span></li><li class="L5"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">strpos</span><span class="pun">(</span><span class="pln">$val</span><span class="pun">,</span><span class="pln"> </span><span class="str">'$'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> FALSE AND strpos</span><span class="pun">(</span><span class="pln">$key</span><span class="pun">,</span><span class="pln"> </span><span class="str">'('</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> FALSE</span><span class="pun">)</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="pln">$val </span><span class="pun">=</span><span class="pln"> preg_replace</span><span class="pun">(</span><span class="str">'#^'</span><span class="pun">.</span><span class="pln">$key</span><span class="pun">.</span><span class="str">'$#'</span><span class="pun">,</span><span class="pln"> $val</span><span class="pun">,</span><span class="pln"> $uri</span><span class="pun">);</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_set_request</span><span class="pun">(</span><span class="pln">explode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $val</span><span class="pun">));</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_request</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">);</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">// --------------------------------------------------------------------</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">/**</span></li><li class="L9"><span class="com">* Set the class name</span></li><li class="L0"><span class="com">*/</span></li><li class="L1"><span class="kwd">function</span><span class="pln"> set_class</span><span class="pun">(</span><span class="pln">$class</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> str_replace</span><span class="pun">(</span><span class="pln">array</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'.'</span><span class="pun">),</span><span class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> $class</span><span class="pun">);</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">// --------------------------------------------------------------------</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">/**</span></li><li class="L9"><span class="com">* Fetch the current class</span></li><li class="L0"><span class="com">*/</span></li><li class="L1"><span class="kwd">function</span><span class="pln"> fetch_class</span><span class="pun">()</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="kwd">class</span><span class="pun">;</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">// --------------------------------------------------------------------</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">/**</span></li><li class="L9"><span class="com">* Set the method name</span></li><li class="L0"><span class="com">*/</span></li><li class="L1"><span class="kwd">function</span><span class="pln"> set_method</span><span class="pun">(</span><span class="pln">$method</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">method </span><span class="pun">=</span><span class="pln"> $method</span><span class="pun">;</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">// --------------------------------------------------------------------</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">/**</span></li><li class="L9"><span class="com">* Fetch the current method</span></li><li class="L0"><span class="com">*/</span></li><li class="L1"><span class="kwd">function</span><span class="pln"> fetch_method</span><span class="pun">()</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">method </span><span class="pun">==</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">fetch_class</span><span class="pun">())</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="kwd">return</span><span class="pln"> </span><span class="str">'index'</span><span class="pun">;</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">method</span><span class="pun">;</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">// --------------------------------------------------------------------</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* Set the directory name</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">function</span><span class="pln"> set_directory</span><span class="pun">(</span><span class="pln">$dir</span><span class="pun">)</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">directory </span><span class="pun">=</span><span class="pln"> str_replace</span><span class="pun">(</span><span class="pln">array</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'.'</span><span class="pun">),</span><span class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> $dir</span><span class="pun">).</span><span class="str">'/'</span><span class="pun">;</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">// --------------------------------------------------------------------</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* Fetch the sub-directory (if any) that contains the requested controller class</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">function</span><span class="pln"> fetch_directory</span><span class="pun">()</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">directory</span><span class="pun">;</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">// --------------------------------------------------------------------</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* Set the controller overrides</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">function</span><span class="pln"> _set_overrides</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">)</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> is_array</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">))</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="kwd">return</span><span class="pun">;</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">[</span><span class="str">'directory'</span><span class="pun">]))</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_directory</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">[</span><span class="str">'directory'</span><span class="pun">]);</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">[</span><span class="str">'controller'</span><span class="pun">])</span><span class="pln"> AND $routing</span><span class="pun">[</span><span class="str">'controller'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_class</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">[</span><span class="str">'controller'</span><span class="pun">]);</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">[</span><span class="str">'function'</span><span class="pun">]))</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">$routing</span><span class="pun">[</span><span class="str">'function'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">[</span><span class="str">'function'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'index'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> $routing</span><span class="pun">[</span><span class="str">'function'</span><span class="pun">];</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">set_method</span><span class="pun">(</span><span class="pln">$routing</span><span class="pun">[</span><span class="str">'function'</span><span class="pun">]);</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pun">}</span></li></ol></pre>
<p>转载请注明：<a href="http://calixwu.com/" data-original-title="" title="">Calix</a> » <a href="./CodeIgniter源码分析之Router.php – Calix的博客_files/CodeIgniter源码分析之Router.php – Calix的博客.html" data-original-title="" title="">CodeIgniter源码分析之Router.php</a></p>

      
<div class="article-social">
			<a href="javascript:;" data-action="ding" data-id="29" id="Addlike" class="action" data-original-title="" title=""><i class="fa fa-heart-o"></i>喜欢 (<span class="count">5</span>)</a><span class="or">or</span><span class="action action-share bdsharebuttonbox bdshare-button-style0-24" data-bd-bind="1467156982493"><i class="fa fa-share-alt"></i>分享 (<span class="bds_count" data-cmd="count" title="累计分享2次">2</span>)<div class="action-popover"><div class="popover top in"><div class="arrow"></div><div class="popover-content"><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html#" class="sinaweibo fa fa-weibo" data-cmd="tsina" title="" data-original-title="分享到新浪微博"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html#" class="bds_qzone fa fa-star" data-cmd="qzone" title="" data-original-title="分享到QQ空间"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html#" class="tencentweibo fa fa-tencent-weibo" data-cmd="tqq" title="" data-original-title="分享到腾讯微博"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html#" class="qq fa fa-qq" data-cmd="sqq" title="" data-original-title="分享到QQ好友"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html#" class="bds_renren fa fa-renren" data-cmd="renren" title="" data-original-title="分享到人人网"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="" data-original-title="分享到微信"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html#" class="bds_more fa fa-ellipsis-h" data-cmd="more" data-original-title="" title=""></a></div></div></div></span>	
</div>
	</article>	
				<footer class="article-footer">
			<div class="article-tags"><i class="fa fa-tags"></i><a href="http://calixwu.com/tag/codeigniter" rel="tag" data-original-title="" title="">CodeIgniter</a><a href="http://calixwu.com/tag/mvc" rel="tag" data-original-title="" title="">MVC</a><a href="http://calixwu.com/tag/router" rel="tag" data-original-title="" title="">ROUTER</a><a href="http://calixwu.com/tag/uri" rel="tag" data-original-title="" title="">URI</a><a href="http://calixwu.com/tag/%e6%a1%86%e6%9e%b6" rel="tag" data-original-title="" title="">框架</a><a href="http://calixwu.com/tag/%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" rel="tag" data-original-title="" title="">源码分析</a></div></footer>
	<nav class="article-nav">
			<span class="article-nav-prev"><i class="fa fa-angle-double-left"></i> <a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-exception-php.html" rel="prev">CodeIgniter源码分析之Exception.php</a></span>
			<span class="article-nav-next"><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html" rel="next">CodeIgniter源码分析之URI.php</a>  <i class="fa fa-angle-double-right"></i></span>
		</nav>

		<div class="related_top">
			<div class="related_posts">

<div class="relates">
<ul>
<li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi.html">Memcached源码分析</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-from-set.html">Memcached源码分析之从SET命令开始说起</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-xianchengmoxing.html">Memcached源码分析之线程模型</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-qingqiuchuli-zhuangtaiji.html">Memcached源码分析之请求处理（状态机）</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-neicunguanli.html">Memcached源码分析之内存管理</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-memcached-h.html">Memcached源码分析之memcached.h</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-memcached-c.html">Memcached源码分析之memcached.c</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-thread-c.html">Memcached源码分析之thread.c</a></li>
</ul></div></div>		</div>
						<div id="respond" class="no_webshot">
		<form action="http://calixwu.com/wp-comments-post.php" method="post" id="commentform">
		
		<div class="comt-title">
			<div class="comt-avatar pull-left">
				<img src="./CodeIgniter源码分析之Router.php – Calix的博客_files/m32.gif" class="avatar avatar-0" height="54px" width="54px">			</div>
			<div class="comt-author pull-left">
			发表我的评论			</div>
			<a id="cancel-comment-reply-link" class="pull-right" href="javascript:;">取消评论</a>
		</div>
		
		<div class="comt">
			<div class="comt-box">
				<textarea placeholder="写点什么..." class="input-block-level comt-area" name="comment" id="comment" cols="100%" rows="3" tabindex="1" onkeydown="if(event.ctrlKey&amp;&amp;event.keyCode==13){document.getElementById(&#39;submit&#39;).click();return false};"></textarea>
				<div class="comt-ctrl">
					<button class="btn btn-primary pull-right" type="submit" name="submit" id="submit" tabindex="5"><i class="fa fa-check-square-o"></i> 提交评论</button>
					<div class="comt-tips pull-right"><input type="hidden" name="comment_post_ID" value="29" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
<div class="comt-tip comt-loading" style="display: none;">正在提交, 请稍候...</div><div class="comt-tip comt-error" style="display: none;">#</div></div>
					<span data-type="comment-insert-smilie" class="muted comt-smilie"><i class="fa fa-smile-o"></i> 表情</span>
					<span class="muted comt-mailme"><label for="comment_mail_notify" class="checkbox inline" style="padding-top:0"><input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify" checked="checked">有人回复时邮件通知我</label></span>
				</div>
			</div>

												<div class="comt-comterinfo" id="comment-author-info">
						<h4>亲~ 写下昵称哦~</h4>
						<ul>
							<li class="form-inline"><label class="hide" for="author">昵称</label><input class="ipt" type="text" name="author" id="author" value="" tabindex="2" placeholder="昵称"><span class="help-inline">昵称 (必填)</span></li>
						<!--	<li class="form-inline"><label class="hide" for="email">邮箱</label><input class="ipt" type="text" name="email" id="email" value="" tabindex="3" placeholder="邮箱"><span class="help-inline">邮箱 (必填)</span></li> -->
							<li class="form-inline"><label class="hide" for="url">网址</label><input class="ipt" type="text" name="url" id="url" value="" tabindex="4" placeholder="网址"><span class="help-inline">网址</span></li> 
						</ul>
					</div>
									</div>

		
	</form>
	</div>
<div id="postcomments">
	<div id="comments">
		<i class="fa fa-comments-o"></i> <b> (1)</b>个小伙伴在吐槽
	</div>
	<ol class="commentlist">
			</ol>
	<div class="commentnav">
			</div>
</div>
			</div>
</div>
<aside class="sidebar">	
<div class="widget widget_text"><div class="textwidget"><div class="social">
<a href="http://calixwu.com/feed" rel="external nofollow" target="_blank" title="" data-original-title="订阅本站"><i class="rss fa fa-rss"></i></a></div></div></div>

		<div class="widget widget_recent_entries">		<div class="title"><h2>近期文章</h2></div>		<ul>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi.html">Memcached源码分析</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-from-set.html">Memcached源码分析之从SET命令开始说起</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-xianchengmoxing.html">Memcached源码分析之线程模型</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-qingqiuchuli-zhuangtaiji.html">Memcached源码分析之请求处理（状态机）</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-neicunguanli.html">Memcached源码分析之内存管理</a>
						</li>
				</ul>
		</div><div class="widget widget_categories"><div class="title"><h2>分类目录</h2></div>		<ul>
	<li class="cat-item cat-item-4"><a href="http://calixwu.com/category/codeigniter">CodeIgniter</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://calixwu.com/category/memcached">Memcached</a>
</li>
		</ul>
</div></aside>
</section>
<footer class="footer">
    <div class="footer-inner">
        <div class="copyright pull-left">
        	<a href="http://calixwu.com/" title="Calix的博客">Calix的博客</a> 版权所有，保留一切权利 ·   基于<a href="http://cn.wordpress.org/">WordPress</a>构建   © 2014-2015

	</div>
        <div class="trackcode pull-right">
            <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F77f536717c5f64cbc346960632d9eedb' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./CodeIgniter源码分析之Router.php – Calix的博客_files/h.js" type="text/javascript"></script><a href="http://tongji.baidu.com/hm-web/welcome/ico?s=77f536717c5f64cbc346960632d9eedb" target="_blank"><img border="0" src="./CodeIgniter源码分析之Router.php – Calix的博客_files/21.gif" width="20" height="20"></a>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254487188'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1254487188' type='text/javascript'%3E%3C/script%3E"));</script><span id="cnzz_stat_icon_1254487188"><a href="http://www.cnzz.com/stat/website.php?web_id=1254487188" target="_blank" title="站长统计">站长统计</a></span><script src="./CodeIgniter源码分析之Router.php – Calix的博客_files/z_stat.php" type="text/javascript"></script><script src="./CodeIgniter源码分析之Router.php – Calix的博客_files/core.php" charset="utf-8" type="text/javascript"></script>        </div>
    </div>
</footer>

<script>with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date()/36e5)];</script>

<div class="rollto"><button class="btn btn-inverse" data-type="totop" title="回顶部"><i class="fa fa-arrow-up"></i></button><button class="btn btn-inverse" data-type="torespond" title="发评论"><i class="fa fa-comment-o"></i></button></div></body></html>