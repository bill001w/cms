<!DOCTYPE html>
<!-- saved from url=(0063)http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html -->
<html><style type="text/css" id="89010683089"></style><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<title>CodeIgniter源码分析之URI.php – Calix的博客</title>
<script>
window._deel = {name: 'Calix',url: 'http://calixwu.com/wp-content/themes/yusi1.0', ajaxpager: '', commenton: 1, roll: [0,0]}
</script>
<meta name="author" content="calix,吴国清,calixwu">
<link rel="stylesheet" id="style-css" href="./CodeIgniter源码分析之URI.php – Calix的博客_files/style.css" type="text/css" media="all">
<script type="text/javascript" src="./CodeIgniter源码分析之URI.php – Calix的博客_files/jquery.min.js"></script>
<script type="text/javascript" src="./CodeIgniter源码分析之URI.php – Calix的博客_files/jquery.js"></script>
<link rel="prev" title="CodeIgniter源码分析之Router.php" href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html">
<link rel="next" title="CodeIgniter源码分析之Common.php" href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-common-php.html">
<link rel="canonical" href="./CodeIgniter源码分析之URI.php – Calix的博客_files/CodeIgniter源码分析之URI.php – Calix的博客.html">
<link rel="shortlink" href="http://calixwu.com/?p=32">
<meta name="keywords" content="CodeIgniter, MVC, ROUTER, URI, 框架, 源码分析, CodeIgniter">
<meta name="description" content="作者：Calix &lt;?php if ( ! defined(&#39;BASEPATH&#39;)) exit(&#39;No direct script access allowed&#39;); // ------------------------------------------------------------------------  /** * URI Class */ class CI_URI {  /** * List of cached ">
<style type="text/css" id="syntaxhighlighteranchor"></style>
<!--[if lt IE 9]><script src="http://calixwu.com/wp-content/themes/yusi1.0/js/html5.js"></script><![endif]-->
<script src="./CodeIgniter源码分析之URI.php – Calix的博客_files/share.js"></script><link href="./CodeIgniter源码分析之URI.php – Calix的博客_files/share.css" rel="styleSheet" type="text/css"></head>
<body class="single single-post postid-32 single-format-standard">

<header id="header" class="header">
<div class="container-inner">
 <div class="yusi-logo">
                    <a href="http://calixwu.com/">
                        <h1>
                                                        <span class="yusi-mono">Calix</span>
                                                        <span class="yusi-bloger">善于总结。</span>
                                                    </h1>
                    </a>
    </div>
</div>

	<div id="nav-header" class="navbar fixed">
		
		<ul class="nav">
			<li id="menu-item-4" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-4"><a href="http://calixwu.com/">首页</a></li>
<li style="float:right;">
                    <div class="toggle-search"><i class="fa fa-search"></i></div>
<div class="search-expand" style="display: none;"><div class="search-expand-inner"><form method="get" class="searchform themeform" onsubmit="location.href=&#39;http://calixwu.com/search/&#39; + encodeURIComponent(this.s.value).replace(/%20/g, &#39;+&#39;); return false;" action="http://calixwu.com/"><div> <input type="ext" class="search" name="s" onblur="if(this.value==&#39;&#39;)this.value=&#39;search...&#39;;" onfocus="if(this.value==&#39;search...&#39;)this.value=&#39;&#39;;" value="search..."></div></form></div></div>
</li>
		</ul><div class="screen-mini"><button data-type="screen-nav" class="btn btn-inverse screen-nav"><i class="fa fa-list"></i></button></div>
	</div>
</header>
<section class="container"><div class="speedbar">
				<div class="toptip"><strong class="text-success"><i class="fa fa-volume-up"></i> </strong> </div>
	</div>
	<div class="content-wrap">
	<div class="content">

				<header class="article-header">
			<h1 class="article-title"><a href="./CodeIgniter源码分析之URI.php – Calix的博客_files/CodeIgniter源码分析之URI.php – Calix的博客.html">CodeIgniter源码分析之URI.php</a></h1>
			<div class="meta">
				<span id="mute-category" class="muted"><i class="fa fa-list-alt"></i><a href="http://calixwu.com/category/codeigniter"> CodeIgniter</a></span>				<!--
				<span class="muted"><i class="fa fa-user"></i> <a href="http://calixwu.com/author/calix">calix</a></span>-->
				<time class="muted"><i class="fa fa-clock-o"></i> 2年前 (2014-11-19)</time>
				<span class="muted" style="color:#dd6666"><i class="fa fa-eye"></i> 1116℃</span>
											</div>
		</header>
		<article class="article-content">
			<p>作者：<a href="http://calixwu.com/" data-original-title="" title="">Calix</a></p>
<pre class="prettyprint linenums"><ol class="linenums"><li class="L0"><span class="pun">&lt;?</span><span class="pln">php </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> </span><span class="kwd">defined</span><span class="pun">(</span><span class="str">'BASEPATH'</span><span class="pun">))</span><span class="pln"> </span><span class="kwd">exit</span><span class="pun">(</span><span class="str">'No direct script access allowed'</span><span class="pun">);</span></li><li class="L1"><span class="com">// ------------------------------------------------------------------------</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* URI Class</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">class</span><span class="pln"> CI_URI </span><span class="pun">{</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">/**</span></li><li class="L9"><span class="com">* List of cached uri segments</span></li><li class="L0"><span class="com">*/</span></li><li class="L1"><span class="kwd">var</span><span class="pln"> $keyval </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">/**</span></li><li class="L5"><span class="com">* Current uri string</span></li><li class="L6"><span class="com">*/</span></li><li class="L7"><span class="kwd">var</span><span class="pln"> $uri_string</span><span class="pun">;</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* List of uri segments</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="kwd">var</span><span class="pln"> $segments </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* Re-indexed list of uri segments</span></li><li class="L8"><span class="com">*/</span></li><li class="L9"><span class="kwd">var</span><span class="pln"> $rsegments </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">/**</span></li><li class="L2"><span class="com">* Constructor</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config </span><span class="pun">=&amp;</span><span class="pln"> load_class</span><span class="pun">(</span><span class="str">'Config'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'core'</span><span class="pun">);</span></li><li class="L7"><span class="pln">log_message</span><span class="pun">(</span><span class="str">'debug'</span><span class="pun">,</span><span class="pln"> </span><span class="str">"URI Class Initialized"</span><span class="pun">);</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">// --------------------------------------------------------------------</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* Get the URI String</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="com">//URI组件里面有很多方法，大都是一些辅助作用的方法，而此方法是URI最主线的一个方法。</span></li><li class="L7"><span class="kwd">function</span><span class="pln"> _fetch_uri_string</span><span class="pun">()</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="com">//下面的uri_protocol是在config.php里面的一个配置项，其实是问你用哪种方式去检测uri的信息的意思，</span></li><li class="L0"><span class="com">//默认是AUTO，自动检测，也就是通过各种方式检测，直至检测到，或者全部方式都检测完。。</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">strtoupper</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'uri_protocol'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'AUTO'</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="com">//开始尝试各种方式,主要有：命令行，REQUEST_URI, PATH_INFO, QUERY_STRING.</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">//下面会多次出现$this-&gt;_set_uri_string($str)这个方法，这个方法没别的，就是把$str经过</span></li><li class="L6"><span class="com">//过滤和修剪后值给$this-&gt;uri_string属性，在这里暂时可以理解为就是赋值。</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">//如果脚本是在命令行模式下运行的话，那么参数就是通过$_SERVER['argv']来传递。下面的</span></li><li class="L9"><span class="com">//$this-&gt;_parse_cli_args();就是拿到符合我们需要的路由相关的一些参数鸟～如果大部分</span></li><li class="L0"><span class="com">//情况你没用命令行执行脚本的话，下面这个if暂时可以不用管。</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">php_sapi_name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'cli'</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> </span><span class="kwd">defined</span><span class="pun">(</span><span class="str">'STDIN'</span><span class="pun">))</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_parse_cli_args</span><span class="pun">());</span></li><li class="L4"><span class="kwd">return</span><span class="pun">;</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">//这种REQUEST_URI方式相对复杂一点，因此封装在$this-&gt;_detect_uri()；里面。</span></li><li class="L8"><span class="com">//其实大多数情况下，利用REQUEST URI和SCRIPT NAME都会得到我们想要的路径信息了。</span></li><li class="L9"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_detect_uri</span><span class="pun">())</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">);</span></li><li class="L2"><span class="kwd">return</span><span class="pun">;</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">//PATH_INFO方式，个人觉得这种方式最经济，只是不是每次请求都有$_SERVER['PATH_INFO']这个变量。</span></li><li class="L6"><span class="pln">$path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'PATH_INFO'</span><span class="pun">]))</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $_SERVER</span><span class="pun">[</span><span class="str">'PATH_INFO'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">@getenv</span><span class="pun">(</span><span class="str">'PATH_INFO'</span><span class="pun">);</span></li><li class="L7"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">trim</span><span class="pun">(</span><span class="pln">$path</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> $path </span><span class="pun">!=</span><span class="pln"> </span><span class="str">"/"</span><span class="pun">.</span><span class="pln">SELF</span><span class="pun">)</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">$path</span><span class="pun">);</span></li><li class="L0"><span class="kwd">return</span><span class="pun">;</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">//如果是用QUERY_STRING的话，路径格式一般为index.php?/controller/method/xxx/xxx</span></li><li class="L4"><span class="pln">$path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'QUERY_STRING'</span><span class="pun">]))</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $_SERVER</span><span class="pun">[</span><span class="str">'QUERY_STRING'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">@getenv</span><span class="pun">(</span><span class="str">'QUERY_STRING'</span><span class="pun">);</span></li><li class="L5"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">trim</span><span class="pun">(</span><span class="pln">$path</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">$path</span><span class="pun">);</span></li><li class="L8"><span class="kwd">return</span><span class="pun">;</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">//上面的方法都不行，那真是奇怪了。。所以尝试最后一种奇葩的方法，就是从$_GET里面把那个键名拿出来。</span></li><li class="L2"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">is_array</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> trim</span><span class="pun">(</span><span class="pln">key</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">),</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">key</span><span class="pun">(</span><span class="pln">$_GET</span><span class="pun">));</span></li><li class="L5"><span class="kwd">return</span><span class="pun">;</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">// We've exhausted all our options...</span></li><li class="L9"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri_string </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L0"><span class="kwd">return</span><span class="pun">;</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">//厄，这里是因为上面那个获得uri_protocol配置的语句写在if里面，然后又没赋值到某个变量，所以这里要再写一次了</span></li><li class="L4"><span class="com">//可能是因为大多数情况下，我们都是选择AUTO方式吧。但是，这样写又何必呢。。</span></li><li class="L5"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> strtoupper</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'uri_protocol'</span><span class="pun">));</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">//其实就是按规定的方式去找路径而已。。</span></li><li class="L8"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$uri </span><span class="pun">==</span><span class="pln"> </span><span class="str">'REQUEST_URI'</span><span class="pun">)</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_detect_uri</span><span class="pun">());</span></li><li class="L1"><span class="kwd">return</span><span class="pun">;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">elseif </span><span class="pun">(</span><span class="pln">$uri </span><span class="pun">==</span><span class="pln"> </span><span class="str">'CLI'</span><span class="pun">)</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_parse_cli_args</span><span class="pun">());</span></li><li class="L6"><span class="kwd">return</span><span class="pun">;</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">//如果你在配置文件config.php里面把这个uri_protocol定义成一种上面都没有的方式，那么就会执行下面的代码。</span></li><li class="L0"><span class="com">//意思是，就看$_SERVER有没有这个uri_protocol的变量了，有就给，没有就拉倒。</span></li><li class="L1"><span class="pln">$path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="pln">$uri</span><span class="pun">]))</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $_SERVER</span><span class="pun">[</span><span class="pln">$uri</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">@getenv</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">);</span></li><li class="L2"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_set_uri_string</span><span class="pun">(</span><span class="pln">$path</span><span class="pun">);</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">// --------------------------------------------------------------------</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">/**</span></li><li class="L8"><span class="com">* Set the URI String</span></li><li class="L9"><span class="com">*/</span></li><li class="L0"><span class="kwd">function</span><span class="pln"> _set_uri_string</span><span class="pun">(</span><span class="pln">$str</span><span class="pun">)</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="com">// Filter out control characters</span></li><li class="L3"><span class="pln">$str </span><span class="pun">=</span><span class="pln"> remove_invisible_characters</span><span class="pun">(</span><span class="pln">$str</span><span class="pun">,</span><span class="pln"> FALSE</span><span class="pun">);</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">// If the URI contains only a slash we'll kill it</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri_string </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$str </span><span class="pun">==</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> $str</span><span class="pun">;</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// --------------------------------------------------------------------</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">/**</span></li><li class="L2"><span class="com">* Detects the URI</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> _detect_uri</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="com">//如果这两个值缺少其中一个，那么这种方法行不通。</span></li><li class="L7"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> isset</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'REQUEST_URI'</span><span class="pun">])</span><span class="pln"> OR </span><span class="pun">!</span><span class="pln"> isset</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'SCRIPT_NAME'</span><span class="pun">]))</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="kwd">return</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> $_SERVER</span><span class="pun">[</span><span class="str">'REQUEST_URI'</span><span class="pun">];</span><span class="com">//取得request_uri</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">//注意下面这个是===0不是false! 接下来这个if 和下面的elseif分别是script_name有文件名和没有文件名（如</span></li><li class="L5"><span class="com">//http://abc.com/CI/或者http://abc.com/CI/?c=index&amp;m=welcome等）的不同情况的处理。</span></li><li class="L6"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">strpos</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> $_SERVER</span><span class="pun">[</span><span class="str">'SCRIPT_NAME'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="com">//去掉共同部分，取得对路由有用的部分。</span></li><li class="L9"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> substr</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> strlen</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'SCRIPT_NAME'</span><span class="pun">]));</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">elseif </span><span class="pun">(</span><span class="pln">strpos</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> dirname</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'SCRIPT_NAME'</span><span class="pun">]))</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="com">//作用同上</span></li><li class="L4"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> substr</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> strlen</span><span class="pun">(</span><span class="pln">dirname</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'SCRIPT_NAME'</span><span class="pun">])));</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">//这里是为兼容?/abc/xx/的形式。</span></li><li class="L8"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">strncmp</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> </span><span class="str">'?/'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> substr</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">//在这里$uri可能是?xxx＝xx的形式，也可能是直接xxx=xx，也可能是/</span></li><li class="L4"><span class="pln">$parts </span><span class="pun">=</span><span class="pln"> preg_split</span><span class="pun">(</span><span class="str">'#\?#i'</span><span class="pun">,</span><span class="pln"> $uri</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span></li><li class="L5"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> $parts</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span></li><li class="L6"><span class="com">//如果是能通过上述的正则分割出两段，那么，是通过query_string即？的形式进行路由访问</span></li><li class="L7"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$parts</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]))</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'QUERY_STRING'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $parts</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span></li><li class="L0"><span class="pln">parse_str</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'QUERY_STRING'</span><span class="pun">],</span><span class="pln"> $_GET</span><span class="pun">);</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="kwd">else</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'QUERY_STRING'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L5"><span class="pln">$_GET </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">//如果为/，或者为空，有两种情况，要么就是通过query_string，所以此时$parts[0]就是等于下面两种可能，同时我们</span></li><li class="L9"><span class="com">//已经通过$parts[1]拿到要拿的信息，则可以返回。要么就是以段的形式，但是段的信息为空，即直接访问入口文件而没有</span></li><li class="L0"><span class="com">//任何路由信息的传递，也可以直接返回。</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$uri </span><span class="pun">==</span><span class="pln"> </span><span class="str">'/'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> empty</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">))</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="kwd">return</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">;</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">//这里我个人觉得是上面的strpos($uri, $_SERVER['SCRIPT_NAME']) === 0和elseif都无法匹配的时候，</span></li><li class="L7"><span class="com">//返回这个url的path部分。</span></li><li class="L8"><span class="pln">$uri </span><span class="pun">=</span><span class="pln"> parse_url</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> PHP_URL_PATH</span><span class="pun">);</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">// Do some final cleaning of the URI and return it</span></li><li class="L1"><span class="kwd">return</span><span class="pln"> str_replace</span><span class="pun">(</span><span class="pln">array</span><span class="pun">(</span><span class="str">'//'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'../'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> trim</span><span class="pun">(</span><span class="pln">$uri</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">));</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">// --------------------------------------------------------------------</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* Parse cli arguments</span></li><li class="L8"><span class="com">*/</span></li><li class="L9"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> _parse_cli_args</span><span class="pun">()</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="com">//返回在命令行模式下运行时传递的参数。</span></li><li class="L2"><span class="pln">$args </span><span class="pun">=</span><span class="pln"> array_slice</span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'argv'</span><span class="pun">],</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="com">//因为第一个参数是当前文件名，所以从第二个开始才是我们要获取的。</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">//返回一个由'/'字符串拼接的字符串，因为$this-&gt;uri_string是一个字符串。</span></li><li class="L5"><span class="kwd">return</span><span class="pln"> $args </span><span class="pun">?</span><span class="pln"> </span><span class="str">'/'</span><span class="pln"> </span><span class="pun">.</span><span class="pln"> implode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">// --------------------------------------------------------------------</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* Filter segments for malicious characters</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="com">//过滤不合法字符</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> _filter_uri</span><span class="pun">(</span><span class="pln">$str</span><span class="pun">)</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$str </span><span class="pun">!=</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'permitted_uri_chars'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'enable_query_strings'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> FALSE</span><span class="pun">)</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="com">// preg_quote() in PHP 5.3 escapes -, so the str_replace() and addition of - to preg_quote() is to maintain backwards</span></li><li class="L9"><span class="com">// compatibility as many are unaware of how characters in the permitted_uri_chars will be parsed as a regex pattern</span></li><li class="L0"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> preg_match</span><span class="pun">(</span><span class="str">"|^["</span><span class="pun">.</span><span class="pln">str_replace</span><span class="pun">(</span><span class="pln">array</span><span class="pun">(</span><span class="str">'\\-'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\-'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'-'</span><span class="pun">,</span><span class="pln"> preg_quote</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'permitted_uri_chars'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'-'</span><span class="pun">)).</span><span class="str">"]+$|i"</span><span class="pun">,</span><span class="pln"> $str</span><span class="pun">))</span></li><li class="L1"><span class="pun">{</span></li><li class="L2"><span class="pln">show_error</span><span class="pun">(</span><span class="str">'The URI you submitted has disallowed characters.'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">400</span><span class="pun">);</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">// Convert programatic characters to entities</span></li><li class="L7"><span class="pln">$bad </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'$'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'('</span><span class="pun">,</span><span class="pln"> </span><span class="str">')'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'%28'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'%29'</span><span class="pun">);</span></li><li class="L8"><span class="pln">$good </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'&amp;#36;'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&amp;#40;'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&amp;#41;'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&amp;#40;'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&amp;#41;'</span><span class="pun">);</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="kwd">return</span><span class="pln"> str_replace</span><span class="pun">(</span><span class="pln">$bad</span><span class="pun">,</span><span class="pln"> $good</span><span class="pun">,</span><span class="pln"> $str</span><span class="pun">);</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">// --------------------------------------------------------------------</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">/**</span></li><li class="L6"><span class="com">* Remove the suffix from the URL if needed</span></li><li class="L7"><span class="com">*/</span></li><li class="L8"><span class="com">//去掉url的我们自定义的后缀。</span></li><li class="L9"><span class="kwd">function</span><span class="pln"> _remove_url_suffix</span><span class="pun">()</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'url_suffix'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri_string </span><span class="pun">=</span><span class="pln"> preg_replace</span><span class="pun">(</span><span class="str">"|"</span><span class="pun">.</span><span class="pln">preg_quote</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">config</span><span class="pun">-&gt;</span><span class="pln">item</span><span class="pun">(</span><span class="str">'url_suffix'</span><span class="pun">)).</span><span class="str">"$|"</span><span class="pun">,</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">uri_string</span><span class="pun">);</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">// --------------------------------------------------------------------</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* Explode the URI Segments. The individual segments will</span></li><li class="L2"><span class="com">* be stored in the $this-&gt;segments array.</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="com">//把uri_string拆成段（同时对各段进行过滤），保存到URI::$segments中。</span></li><li class="L5"><span class="kwd">function</span><span class="pln"> _explode_segments</span><span class="pun">()</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">(</span><span class="pln">explode</span><span class="pun">(</span><span class="str">"/"</span><span class="pun">,</span><span class="pln"> preg_replace</span><span class="pun">(</span><span class="str">"|/*(.+?)/*$|"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"\\1"</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">uri_string</span><span class="pun">))</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> $val</span><span class="pun">)</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="com">// Filter segments for security</span></li><li class="L0"><span class="pln">$val </span><span class="pun">=</span><span class="pln"> trim</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_filter_uri</span><span class="pun">(</span><span class="pln">$val</span><span class="pun">));</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$val </span><span class="pun">!=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $val</span><span class="pun">;</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// --------------------------------------------------------------------</span></li><li class="L0"><span class="com">/**</span></li><li class="L1"><span class="com">* Re-index Segments</span></li><li class="L2"><span class="com">*/</span></li><li class="L3"><span class="com">//使得出来的段以下标1开始保存。</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> _reindex_segments</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="pln">array_unshift</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">);</span></li><li class="L7"><span class="pln">array_unshift</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">rsegments</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">);</span></li><li class="L8"><span class="pln">unset</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L9"><span class="pln">unset</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">rsegments</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">// --------------------------------------------------------------------</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">/**</span></li><li class="L5"><span class="com">* Fetch a URI Segment</span></li><li class="L6"><span class="com">*/</span></li><li class="L7"><span class="com">//返回某一段</span></li><li class="L8"><span class="kwd">function</span><span class="pln"> segment</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $no_result </span><span class="pun">=</span><span class="pln"> FALSE</span><span class="pun">)</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> isset</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">[</span><span class="pln">$n</span><span class="pun">]))</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $no_result </span><span class="pun">:</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">[</span><span class="pln">$n</span><span class="pun">];</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">// --------------------------------------------------------------------</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">/**</span></li><li class="L6"><span class="com">* Fetch a URI "routed" Segment</span></li><li class="L7"><span class="com">*/</span></li><li class="L8"><span class="com">//返回确定路由后的某一段</span></li><li class="L9"><span class="kwd">function</span><span class="pln"> rsegment</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $no_result </span><span class="pun">=</span><span class="pln"> FALSE</span><span class="pun">)</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> isset</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">rsegments</span><span class="pun">[</span><span class="pln">$n</span><span class="pun">]))</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> $no_result </span><span class="pun">:</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">rsegments</span><span class="pun">[</span><span class="pln">$n</span><span class="pun">];</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="com">// --------------------------------------------------------------------</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="com">/**</span></li><li class="L7"><span class="com">* Generate a key value pair from the URI string</span></li><li class="L8"><span class="com">*/</span></li><li class="L9"><span class="kwd">function</span><span class="pln"> uri_to_assoc</span><span class="pun">(</span><span class="pln">$n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> $default </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">())</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_uri_to_assoc</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $default</span><span class="pun">,</span><span class="pln"> </span><span class="str">'segment'</span><span class="pun">);</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* Identical to above only it uses the re-routed segment array</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">function</span><span class="pln"> ruri_to_assoc</span><span class="pun">(</span><span class="pln">$n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> $default </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">())</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_uri_to_assoc</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $default</span><span class="pun">,</span><span class="pln"> </span><span class="str">'rsegment'</span><span class="pun">);</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">// --------------------------------------------------------------------</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="com">/**</span></li><li class="L4"><span class="com">* Generate a key value pair from the URI string or Re-routed URI string</span></li><li class="L5"><span class="com">*/</span></li><li class="L6"><span class="kwd">function</span><span class="pln"> _uri_to_assoc</span><span class="pun">(</span><span class="pln">$n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> $default </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(),</span><span class="pln"> $which </span><span class="pun">=</span><span class="pln"> </span><span class="str">'segment'</span><span class="pun">)</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$which </span><span class="pun">==</span><span class="pln"> </span><span class="str">'segment'</span><span class="pun">)</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$total_segments </span><span class="pun">=</span><span class="pln"> </span><span class="str">'total_segments'</span><span class="pun">;</span></li><li class="L1"><span class="pln">$segment_array </span><span class="pun">=</span><span class="pln"> </span><span class="str">'segment_array'</span><span class="pun">;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="kwd">else</span></li><li class="L4"><span class="pun">{</span></li><li class="L5"><span class="pln">$total_segments </span><span class="pun">=</span><span class="pln"> </span><span class="str">'total_rsegments'</span><span class="pun">;</span></li><li class="L6"><span class="pln">$segment_array </span><span class="pun">=</span><span class="pln"> </span><span class="str">'rsegment_array'</span><span class="pun">;</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> is_numeric</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">))</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="kwd">return</span><span class="pln"> $default</span><span class="pun">;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isset</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">keyval</span><span class="pun">[</span><span class="pln">$n</span><span class="pun">]))</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">keyval</span><span class="pun">[</span><span class="pln">$n</span><span class="pun">];</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">$total_segments</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> $n</span><span class="pun">)</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">count</span><span class="pun">(</span><span class="pln">$default</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="kwd">return</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">$retval </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L7"><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$default </span><span class="kwd">as</span><span class="pln"> $val</span><span class="pun">)</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">$retval</span><span class="pun">[</span><span class="pln">$val</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> FALSE</span><span class="pun">;</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="kwd">return</span><span class="pln"> $retval</span><span class="pun">;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln">$segments </span><span class="pun">=</span><span class="pln"> array_slice</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">$segment_array</span><span class="pun">(),</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">$i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></li><li class="L7"><span class="pln">$lastval </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L8"><span class="pln">$retval </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L9"><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$segments </span><span class="kwd">as</span><span class="pln"> $seg</span><span class="pun">)</span></li><li class="L0"><span class="pun">{</span></li><li class="L1"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$i </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">$retval</span><span class="pun">[</span><span class="pln">$lastval</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $seg</span><span class="pun">;</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="kwd">else</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="pln">$retval</span><span class="pun">[</span><span class="pln">$seg</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> FALSE</span><span class="pun">;</span></li><li class="L8"><span class="pln">$lastval </span><span class="pun">=</span><span class="pln"> $seg</span><span class="pun">;</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="pln">$i</span><span class="pun">++;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">count</span><span class="pun">(</span><span class="pln">$default</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$default </span><span class="kwd">as</span><span class="pln"> $val</span><span class="pun">)</span></li><li class="L7"><span class="pun">{</span></li><li class="L8"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> array_key_exists</span><span class="pun">(</span><span class="pln">$val</span><span class="pun">,</span><span class="pln"> $retval</span><span class="pun">))</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$retval</span><span class="pun">[</span><span class="pln">$val</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> FALSE</span><span class="pun">;</span></li><li class="L1"><span class="pun">}</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="com">// Cache the array for reuse</span></li><li class="L6"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">keyval</span><span class="pun">[</span><span class="pln">$n</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $retval</span><span class="pun">;</span></li><li class="L7"><span class="kwd">return</span><span class="pln"> $retval</span><span class="pun">;</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">// --------------------------------------------------------------------</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">/**</span></li><li class="L3"><span class="com">* Generate a URI string from an associative array</span></li><li class="L4"><span class="com">*/</span></li><li class="L5"><span class="kwd">function</span><span class="pln"> assoc_to_uri</span><span class="pun">(</span><span class="pln">$array</span><span class="pun">)</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="pln">$temp </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span></li><li class="L8"><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">((</span><span class="pln">array</span><span class="pun">)</span><span class="pln">$array </span><span class="kwd">as</span><span class="pln"> $key </span><span class="pun">=&gt;</span><span class="pln"> $val</span><span class="pun">)</span></li><li class="L9"><span class="pun">{</span></li><li class="L0"><span class="pln">$temp</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $key</span><span class="pun">;</span></li><li class="L1"><span class="pln">$temp</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> $val</span><span class="pun">;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="kwd">return</span><span class="pln"> implode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $temp</span><span class="pun">);</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">// --------------------------------------------------------------------</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">/**</span></li><li class="L0"><span class="com">* Fetch a URI Segment and add a trailing slash</span></li><li class="L1"><span class="com">*/</span></li><li class="L2"><span class="kwd">function</span><span class="pln"> slash_segment</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $where </span><span class="pun">=</span><span class="pln"> </span><span class="str">'trailing'</span><span class="pun">)</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_slash_segment</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $where</span><span class="pun">,</span><span class="pln"> </span><span class="str">'segment'</span><span class="pun">);</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">// --------------------------------------------------------------------</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">/**</span></li><li class="L0"><span class="com">* Fetch a URI Segment and add a trailing slash</span></li><li class="L1"><span class="com">*/</span></li><li class="L2"><span class="kwd">function</span><span class="pln"> slash_rsegment</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $where </span><span class="pun">=</span><span class="pln"> </span><span class="str">'trailing'</span><span class="pun">)</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_slash_segment</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $where</span><span class="pun">,</span><span class="pln"> </span><span class="str">'rsegment'</span><span class="pun">);</span></li><li class="L5"><span class="pun">}</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="com">// --------------------------------------------------------------------</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">/**</span></li><li class="L0"><span class="com">* Fetch a URI Segment and add a trailing slash - helper function</span></li><li class="L1"><span class="com">*/</span></li><li class="L2"><span class="kwd">function</span><span class="pln"> _slash_segment</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">,</span><span class="pln"> $where </span><span class="pun">=</span><span class="pln"> </span><span class="str">'trailing'</span><span class="pun">,</span><span class="pln"> $which </span><span class="pun">=</span><span class="pln"> </span><span class="str">'segment'</span><span class="pun">)</span></li><li class="L3"><span class="pun">{</span></li><li class="L4"><span class="pln">$leading </span><span class="pun">=</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">;</span></li><li class="L5"><span class="pln">$trailing </span><span class="pun">=</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">;</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$where </span><span class="pun">==</span><span class="pln"> </span><span class="str">'trailing'</span><span class="pun">)</span></li><li class="L8"><span class="pun">{</span></li><li class="L9"><span class="pln">$leading </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">elseif </span><span class="pun">(</span><span class="pln">$where </span><span class="pun">==</span><span class="pln"> </span><span class="str">'leading'</span><span class="pun">)</span></li><li class="L2"><span class="pun">{</span></li><li class="L3"><span class="pln">$trailing </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></li><li class="L4"><span class="pun">}</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="kwd">return</span><span class="pln"> $leading</span><span class="pun">.</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">$which</span><span class="pun">(</span><span class="pln">$n</span><span class="pun">).</span><span class="pln">$trailing</span><span class="pun">;</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// --------------------------------------------------------------------</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">/**</span></li><li class="L2"><span class="com">* Segment Array</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> segment_array</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">;</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// --------------------------------------------------------------------</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">/**</span></li><li class="L2"><span class="com">* Routed Segment Array</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> rsegment_array</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">rsegments</span><span class="pun">;</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// --------------------------------------------------------------------</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">/**</span></li><li class="L2"><span class="com">* Total number of segments</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> total_segments</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">return</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">segments</span><span class="pun">);</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// --------------------------------------------------------------------</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">/**</span></li><li class="L2"><span class="com">* Total number of routed segments</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> total_rsegments</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">return</span><span class="pln"> count</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">rsegments</span><span class="pun">);</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="com">// --------------------------------------------------------------------</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="com">/**</span></li><li class="L2"><span class="com">* Fetch the entire URI string</span></li><li class="L3"><span class="com">*/</span></li><li class="L4"><span class="kwd">function</span><span class="pln"> uri_string</span><span class="pun">()</span></li><li class="L5"><span class="pun">{</span></li><li class="L6"><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">uri_string</span><span class="pun">;</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="com">// --------------------------------------------------------------------</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="com">/**</span></li><li class="L3"><span class="com">* Fetch the entire Re-routed URI string</span></li><li class="L4"><span class="com">*/</span></li><li class="L5"><span class="kwd">function</span><span class="pln"> ruri_string</span><span class="pun">()</span></li><li class="L6"><span class="pun">{</span></li><li class="L7"><span class="kwd">return</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">.</span><span class="pln">implode</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">rsegment_array</span><span class="pun">());</span></li><li class="L8"><span class="pun">}</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pun">}</span></li></ol></pre>
<p>转载请注明：<a href="http://calixwu.com/" data-original-title="" title="">Calix</a> » <a href="./CodeIgniter源码分析之URI.php – Calix的博客_files/CodeIgniter源码分析之URI.php – Calix的博客.html" data-original-title="" title="">CodeIgniter源码分析之URI.php</a></p>

      
<div class="article-social">
			<a href="javascript:;" data-action="ding" data-id="32" id="Addlike" class="action" data-original-title="" title=""><i class="fa fa-heart-o"></i>喜欢 (<span class="count">2</span>)</a><span class="or">or</span><span class="action action-share bdsharebuttonbox bdshare-button-style0-24" data-bd-bind="1467156931290"><i class="fa fa-share-alt"></i>分享 (<span class="bds_count" data-cmd="count" title="累计分享0次">0</span>)<div class="action-popover"><div class="popover top in"><div class="arrow"></div><div class="popover-content"><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html#" class="sinaweibo fa fa-weibo" data-cmd="tsina" title="" data-original-title="分享到新浪微博"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html#" class="bds_qzone fa fa-star" data-cmd="qzone" title="" data-original-title="分享到QQ空间"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html#" class="tencentweibo fa fa-tencent-weibo" data-cmd="tqq" title="" data-original-title="分享到腾讯微博"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html#" class="qq fa fa-qq" data-cmd="sqq" title="" data-original-title="分享到QQ好友"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html#" class="bds_renren fa fa-renren" data-cmd="renren" title="" data-original-title="分享到人人网"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="" data-original-title="分享到微信"></a><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-uri-php.html#" class="bds_more fa fa-ellipsis-h" data-cmd="more" data-original-title="" title=""></a></div></div></div></span>	
</div>
	</article>	
				<footer class="article-footer">
			<div class="article-tags"><i class="fa fa-tags"></i><a href="http://calixwu.com/tag/codeigniter" rel="tag" data-original-title="" title="">CodeIgniter</a><a href="http://calixwu.com/tag/mvc" rel="tag" data-original-title="" title="">MVC</a><a href="http://calixwu.com/tag/router" rel="tag" data-original-title="" title="">ROUTER</a><a href="http://calixwu.com/tag/uri" rel="tag" data-original-title="" title="">URI</a><a href="http://calixwu.com/tag/%e6%a1%86%e6%9e%b6" rel="tag" data-original-title="" title="">框架</a><a href="http://calixwu.com/tag/%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" rel="tag" data-original-title="" title="">源码分析</a></div></footer>
	<nav class="article-nav">
			<span class="article-nav-prev"><i class="fa fa-angle-double-left"></i> <a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-router-php.html" rel="prev">CodeIgniter源码分析之Router.php</a></span>
			<span class="article-nav-next"><a href="http://calixwu.com/2014/11/codeigniter-yuanmafenxi-common-php.html" rel="next">CodeIgniter源码分析之Common.php</a>  <i class="fa fa-angle-double-right"></i></span>
		</nav>

		<div class="related_top">
			<div class="related_posts">

<div class="relates">
<ul>
<li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi.html">Memcached源码分析</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-from-set.html">Memcached源码分析之从SET命令开始说起</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-xianchengmoxing.html">Memcached源码分析之线程模型</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-qingqiuchuli-zhuangtaiji.html">Memcached源码分析之请求处理（状态机）</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-neicunguanli.html">Memcached源码分析之内存管理</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-memcached-h.html">Memcached源码分析之memcached.h</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-memcached-c.html">Memcached源码分析之memcached.c</a></li><li><i class="fa fa-minus"></i><a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-thread-c.html">Memcached源码分析之thread.c</a></li>
</ul></div></div>		</div>
						<div id="respond" class="no_webshot">
		<form action="http://calixwu.com/wp-comments-post.php" method="post" id="commentform">
		
		<div class="comt-title">
			<div class="comt-avatar pull-left">
				<img src="./CodeIgniter源码分析之URI.php – Calix的博客_files/m32.gif" class="avatar avatar-0" height="54px" width="54px">			</div>
			<div class="comt-author pull-left">
			发表我的评论			</div>
			<a id="cancel-comment-reply-link" class="pull-right" href="javascript:;">取消评论</a>
		</div>
		
		<div class="comt">
			<div class="comt-box">
				<textarea placeholder="写点什么..." class="input-block-level comt-area" name="comment" id="comment" cols="100%" rows="3" tabindex="1" onkeydown="if(event.ctrlKey&amp;&amp;event.keyCode==13){document.getElementById(&#39;submit&#39;).click();return false};"></textarea>
				<div class="comt-ctrl">
					<button class="btn btn-primary pull-right" type="submit" name="submit" id="submit" tabindex="5"><i class="fa fa-check-square-o"></i> 提交评论</button>
					<div class="comt-tips pull-right"><input type="hidden" name="comment_post_ID" value="32" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
<div class="comt-tip comt-loading" style="display: none;">正在提交, 请稍候...</div><div class="comt-tip comt-error" style="display: none;">#</div></div>
					<span data-type="comment-insert-smilie" class="muted comt-smilie"><i class="fa fa-smile-o"></i> 表情</span>
					<span class="muted comt-mailme"><label for="comment_mail_notify" class="checkbox inline" style="padding-top:0"><input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify" checked="checked">有人回复时邮件通知我</label></span>
				</div>
			</div>

												<div class="comt-comterinfo" id="comment-author-info">
						<h4>亲~ 写下昵称哦~</h4>
						<ul>
							<li class="form-inline"><label class="hide" for="author">昵称</label><input class="ipt" type="text" name="author" id="author" value="" tabindex="2" placeholder="昵称"><span class="help-inline">昵称 (必填)</span></li>
						<!--	<li class="form-inline"><label class="hide" for="email">邮箱</label><input class="ipt" type="text" name="email" id="email" value="" tabindex="3" placeholder="邮箱"><span class="help-inline">邮箱 (必填)</span></li> -->
							<li class="form-inline"><label class="hide" for="url">网址</label><input class="ipt" type="text" name="url" id="url" value="" tabindex="4" placeholder="网址"><span class="help-inline">网址</span></li> 
						</ul>
					</div>
									</div>

		
	</form>
	</div>
<div id="postcomments">
	<div id="comments">
		<i class="fa fa-comments-o"></i> <b> (1)</b>个小伙伴在吐槽
	</div>
	<ol class="commentlist">
			</ol>
	<div class="commentnav">
			</div>
</div>
			</div>
</div>
<aside class="sidebar">	
<div class="widget widget_text"><div class="textwidget"><div class="social">
<a href="http://calixwu.com/feed" rel="external nofollow" target="_blank" title="" data-original-title="订阅本站"><i class="rss fa fa-rss"></i></a></div></div></div>

		<div class="widget widget_recent_entries">		<div class="title"><h2>近期文章</h2></div>		<ul>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi.html">Memcached源码分析</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-from-set.html">Memcached源码分析之从SET命令开始说起</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-xianchengmoxing.html">Memcached源码分析之线程模型</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-qingqiuchuli-zhuangtaiji.html">Memcached源码分析之请求处理（状态机）</a>
						</li>
					<li>
				<a href="http://calixwu.com/2014/11/memcached-yuanmafenxi-neicunguanli.html">Memcached源码分析之内存管理</a>
						</li>
				</ul>
		</div><div class="widget widget_categories"><div class="title"><h2>分类目录</h2></div>		<ul>
	<li class="cat-item cat-item-4"><a href="http://calixwu.com/category/codeigniter">CodeIgniter</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://calixwu.com/category/memcached">Memcached</a>
</li>
		</ul>
</div><div class="widgetRoller" style="position: fixed; top: 10px; z-index: 0; width: 360px;"><div class="widget widget_categories"><div class="title"><h2>分类目录</h2></div>		<ul>
	<li class="cat-item cat-item-4"><a href="http://calixwu.com/category/codeigniter">CodeIgniter</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://calixwu.com/category/memcached">Memcached</a>
</li>
		</ul>
</div></div></aside>
</section>
<footer class="footer">
    <div class="footer-inner">
        <div class="copyright pull-left">
        	<a href="http://calixwu.com/" title="Calix的博客">Calix的博客</a> 版权所有，保留一切权利 ·   基于<a href="http://cn.wordpress.org/">WordPress</a>构建   © 2014-2015

	</div>
        <div class="trackcode pull-right">
            <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F77f536717c5f64cbc346960632d9eedb' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./CodeIgniter源码分析之URI.php – Calix的博客_files/h.js" type="text/javascript"></script><a href="http://tongji.baidu.com/hm-web/welcome/ico?s=77f536717c5f64cbc346960632d9eedb" target="_blank"><img border="0" src="./CodeIgniter源码分析之URI.php – Calix的博客_files/21.gif" width="20" height="20"></a>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254487188'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1254487188' type='text/javascript'%3E%3C/script%3E"));</script><span id="cnzz_stat_icon_1254487188"><a href="http://www.cnzz.com/stat/website.php?web_id=1254487188" target="_blank" title="站长统计">站长统计</a></span><script src="./CodeIgniter源码分析之URI.php – Calix的博客_files/z_stat.php" type="text/javascript"></script><script src="./CodeIgniter源码分析之URI.php – Calix的博客_files/core.php" charset="utf-8" type="text/javascript"></script>        </div>
    </div>
</footer>

<script>with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date()/36e5)];</script>

<div class="rollto" style="display: block;"><button class="btn btn-inverse" data-type="totop" title="回顶部"><i class="fa fa-arrow-up"></i></button><button class="btn btn-inverse" data-type="torespond" title="发评论"><i class="fa fa-comment-o"></i></button></div></body></html>